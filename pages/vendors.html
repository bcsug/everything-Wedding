<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üíç</text></svg>">
    
    <!-- Updated CSP Policy -->
   <meta http-equiv="Content-Security-Policy" 
      content="default-src 'self'; 
               connect-src 'self' https://firestore.googleapis.com https://*.firebaseio.com wss://*.firebaseio.com https://wedding-planner-39b5b.firebaseio.com https://securetoken.googleapis.com;
                   img-src 'self' data: blob: https:; 
                   style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/ https://fonts.googleapis.com; 
                   font-src 'self' data: https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/ https://fonts.gstatic.com; 
                   script-src 'self' 'unsafe-inline' https://www.gstatic.com/firebasejs/;">
    
    <meta name="description" content="Find the best wedding vendors for your special day. Browse photographers, caterers, florists, and more.">
    <meta name="keywords" content="wedding vendors, wedding photographers, wedding caterers, wedding florists, wedding planning">
    <meta name="author" content="Tom Mulungi">
    <title>Wedding Vendors | Find Your Perfect Wedding Professionals</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles.css">
    <style>
        /* Vendors Page Specific Styles */
        .vendors-hero {
            background: linear-gradient(135deg, rgba(107, 91, 149, 0.9) 0%, rgba(74, 107, 136, 0.9) 100%);
            color: white;
            padding: 120px 0 80px;
            text-align: center;
            margin-top: 70px;
        }

        .vendors-hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .vendors-hero p {
            font-size: 1.2rem;
            max-width: 600px;
            margin: 0 auto 2rem;
            opacity: 0.9;
        }

        .search-filter-section {
            background: white;
            padding: 2rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 70px;
            z-index: 100;
        }

        .search-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .search-box {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 300px;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #6b5b95;
        }

        .filter-controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-select {
            padding: 0.8rem 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            font-size: 0.9rem;
            min-width: 150px;
        }

        .sort-select {
            padding: 0.8rem 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            font-size: 0.9rem;
        }

        .category-filters {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .category-filter {
            padding: 0.5rem 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .category-filter:hover,
        .category-filter.active {
            background: #6b5b95;
            color: white;
            border-color: #6b5b95;
        }

        .vendors-main {
            padding: 3rem 0;
            background: #f8f9fa;
        }

        .vendors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
            /* Prevent layout shifts */
            contain: layout style paint;
        }

        .vendor-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
            cursor: pointer;
            /* Ensure consistent sizing */
            min-height: 450px;
            contain: content;
        }

        .vendor-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .vendor-card.premium::before {
            content: 'FEATURED';
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 2;
        }

        .vendor-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            /* Prevent image loading shifts */
            background: #f8f9fa;
            aspect-ratio: 16/9;
        }

        .vendor-content {
            padding: 1.5rem;
        }

        .vendor-header {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .vendor-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #6b5b95, #4a6b88);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .vendor-info {
            flex: 1;
        }

        .vendor-info h3 {
            margin: 0 0 0.5rem 0;
            font-size: 1.3rem;
            color: #333;
        }

        .vendor-category {
            color: #6b5b95;
            font-weight: 500;
            margin: 0 0 0.5rem 0;
        }

        .vendor-location {
            color: #666;
            font-size: 0.9rem;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .vendor-description {
            color: #555;
            line-height: 1.5;
            margin-bottom: 1.5rem;
        }

        .vendor-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: #6b5b95;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #666;
            margin-top: 0.2rem;
        }

        .vendor-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-primary {
            flex: 1;
            background: #6b5b95;
            color: white;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s ease;
            text-decoration: none;
            text-align: center;
            display: inline-block;
        }

        .btn-primary:hover {
            background: #5a4a7d;
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid #6b5b95;
            color: #6b5b95;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
            display: inline-block;
        }

        .btn-secondary:hover {
            background: #6b5b95;
            color: white;
        }

        .no-vendors {
            text-align: center;
            padding: 3rem;
            color: #666;
            grid-column: 1 / -1;
        }

        .no-vendors i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #ddd;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-top: 2rem;
        }

        .pagination button {
            padding: 0.8rem 1.5rem;
            border: 2px solid #6b5b95;
            background: white;
            color: #6b5b95;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .pagination button:hover:not(:disabled) {
            background: #6b5b95;
            color: white;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-info {
            color: #666;
            font-weight: 500;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: #666;
            grid-column: 1 / -1;
        }

        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #6b5b95;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto 1rem;
            position: relative;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .vendors-hero h1 {
                font-size: 2rem;
            }

            .vendors-hero p {
                font-size: 1rem;
            }

            .search-box {
                flex-direction: column;
            }

            .search-input {
                min-width: auto;
            }

            .vendors-grid {
                grid-template-columns: 1fr;
            }

            .vendor-stats {
                grid-template-columns: repeat(3, 1fr);
            }

            .vendor-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Header Section -->
    <header id="header">
        <div class="logo">
            <i class="fas fa-ring"></i>
            <h1>Wedding Planner</h1>
        </div>
        <nav aria-label="Main Navigation">
            <button class="mobile-menu-btn" aria-label="Toggle Menu">
                <i class="fas fa-bars"></i>
            </button>
            <ul>
                <li><a href="../index.html">Home</a></li>
                <li><a href="vendors.html" aria-current="page">Vendors</a></li>
                <li><a href="admin add.html">Admin</a></li>
                <li><a href="aboutUs.html">AboutUs</a></li>
                <li><a href="login.html">Login</a></li>
                
            </ul>
        </nav>
    </header>

    <!-- Vendors Hero Section -->
    <section class="vendors-hero">
        <div class="container">
            <h1>Find Your Perfect Wedding Vendors</h1>
            <p>Discover trusted professionals who will make your dream wedding a reality. From photographers to caterers, we've got you covered.</p>
        </div>
    </section>

    <!-- Search and Filter Section -->
    <section class="search-filter-section">
        <div class="search-container">
            <div class="search-box">
                <input type="text" id="search-input" class="search-input" placeholder="Search vendors by name, category, or location...">
                <select id="sort-select" class="sort-select">
                    <option value="name">Sort by Name</option>
                    <option value="rating">Sort by Rating</option>
                    <option value="price">Sort by Price</option>
                </select>
            </div>
            
            <div class="filter-controls">
                <select id="category-filter" class="filter-select">
                    <option value="">All Categories</option>
                    <option value="Photography">Photography</option>
                    <option value="Catering">Catering</option>
                    <option value="Venue">Venue</option>
                    <option value="Florist">Florist</option>
                    <option value="Planner">Wedding Planner</option>
                    <option value="Music">Music & Entertainment</option>
                    <option value="Cake">Wedding Cakes</option>
                    <option value="Transportation">Transportation</option>
                    <option value="Beauty">Beauty & Hair</option>
                    <option value="Attire">Wedding Attire</option>
                    <option value="Jewelry">Jewelry</option>
                </select>
                
                <select id="location-filter" class="filter-select">
                    <option value="">All Locations</option>
                    <option value="Kampala">Kampala</option>
                    <option value="Entebbe">Entebbe</option>
                    <option value="Jinja">Jinja</option>
                    <option value="Mbarara">Mbarara</option>
                    <option value="Gulu">Gulu</option>
                </select>
            </div>

            <div class="category-filters">
                <button class="category-filter active" data-category="">All Vendors</button>
                <button class="category-filter" data-category="premium">Featured</button>
                <button class="category-filter" data-category="Photography">Photography</button>
                <button class="category-filter" data-category="Catering">Catering</button>
                <button class="category-filter" data-category="Venue">Venues</button>
                <button class="category-filter" data-category="Florist">Florists</button>
            </div>
        </div>
    </section>

    <!-- Main Vendors Content -->
    <main class="vendors-main">
        <div class="container">            
            <div id="vendors-container" class="vendors-grid">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading vendors...</p>
                </div>
            </div>

            <div id="pagination" class="pagination" style="display: none;">
                <button id="prev-page" disabled>Previous</button>
                <span class="page-info" id="page-info">Page 1 of 1</span>
                <button id="next-page">Next</button>
            </div>
        </div>
    </main>

    <!-- Newsletter Section -->
    <section id="newsletter">
        <h2>Find More Wedding Professionals</h2>
        <p>Subscribe to get updates on new vendors, special offers, and wedding planning tips.</p>
        <form id="newsletter-form" action="#" method="post">
            <input type="email" placeholder="Enter your email" required>
            <button type="submit">Subscribe</button>
        </form>
    </section>

    <!-- Footer Section -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Wedding Planner</h3>
                    <p>Your trusted partner in creating the wedding of your dreams. We connect you with the best vendors and provide expert planning advice.</p>
                    <div class="social-links">
                        <a href="#" aria-label="Follow us on Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" aria-label="Follow us on Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="#" aria-label="Follow us on Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="#" aria-label="Follow us on Pinterest"><i class="fab fa-pinterest-p"></i></a>
                    </div>
                </div>
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="../index.html">Home</a></li>
                        <li><a href="vendors.html">Vendors</a></li>
                        <li><a href="venues.html">Venues</a></li>
                        <li><a href="inspiration.html">Inspiration</a></li>
                        <li><a href="login.html">Login</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Vendor Resources</h3>
                    <ul class="footer-links">
                        <li><a href="vendor-application.html">List Your Business</a></li>
                        <li><a href="#">Premium Marketing</a></li>
                        <li><a href="#">Advertising Options</a></li>
                        <li><a href="#">Support Center</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Contact Us</h3>
                    <p><i class="fas fa-map-marker-alt"></i> ntinda semawata rd</p>
                    <p><i class="fas fa-phone"></i> +256 772 566 375</p>
                    <p><i class="fas fa-envelope"></i> tom.mulungi@gmail.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p class="copyright">&copy; 2025 Wedding Planner. All rights reserved. Website created by Tom Mulungi.</p>
            </div>
        </div>
    </footer>

    <button id="back-to-top" aria-label="Back to Top"><i class="fas fa-chevron-up"></i></button>

    <script type="module">
        // Import Firebase configuration
        import { db } from '../firebase-config.js';
        import { collection, getDocs } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

        // Vendor Data Handling
        let allVendors = [];
        let currentPage = 1;
        const vendorsPerPage = 9;

        // DOM Elements
        const vendorsContainer = document.getElementById('vendors-container');
        const searchInput = document.getElementById('search-input');
        const categoryFilter = document.getElementById('category-filter');
        const locationFilter = document.getElementById('location-filter');
        const sortSelect = document.getElementById('sort-select');
        const categoryFilters = document.querySelectorAll('.category-filter');
        const prevPageBtn = document.getElementById('prev-page');
        const nextPageBtn = document.getElementById('next-page');
        const pageInfo = document.getElementById('page-info');
        const pagination = document.getElementById('pagination');

        // Debouncing variables
        let searchTimeout;
        let filterTimeout;

        async function fetchVendors() {
            try {
                console.log("Starting to fetch vendors from Firestore...");
                
                const vendorsCollection = collection(db, "vendors");
                const querySnapshot = await getDocs(vendorsCollection);

                console.log(`Firestore query returned ${querySnapshot.size} documents`);

                if (querySnapshot.empty) {
                    showNoVendorsMessage('No vendors found at the moment. Please check back later.');
                    return;
                }

                allVendors = querySnapshot.docs.map(doc => {
                    const data = doc.data();
                    console.log(`Processing vendor: ${doc.id}`, data);
                    
                    return { 
                        id: doc.id, 
                        name: data.name || 'Vendor',
                        category: data.category || 'General',
                        description: data.description || 'Professional wedding services.',
                        location: data.phone || data.location || 'Contact for location',
                        contact: data.email || data.contact || 'Contact vendor',
                        website: data.website || '',
                        priceRange: formatPriceRange(data.price) || 'Contact for pricing',
                        isPremium: data.status === 'paid' || data.isPremium || false,
                        logoUrl: data.logoUrl || '',
                        gallery: data.gallery || [],
                        rating: data.rating || '4.5',
                        isApproved: data.isApproved !== false // Default to true if not specified
                    };
                });

                console.log(`Successfully processed ${allVendors.length} vendors`);

                // Filter only approved vendors for public view
                allVendors = allVendors.filter(vendor => vendor.isApproved);

                if (allVendors.length === 0) {
                    showNoVendorsMessage('No vendors available at the moment.');
                } else {
                    filterAndDisplayVendors();
                }
            } catch (error) {
                console.error("Error fetching vendors: ", error);
                vendorsContainer.innerHTML = `
                    <div class="no-vendors">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Unable to Load Vendors</h3>
                        <p>Please check your internet connection and try again.</p>
                        <p class="text-muted" style="font-size: 0.8rem; margin-top: 1rem;">Error: ${error.message}</p>
                    </div>
                `;
            }
        }

        // Helper function to format price range
        function formatPriceRange(price) {
            if (!price) return null;
            
            const priceNum = parseFloat(price);
            if (priceNum < 100) return '$';
            if (priceNum < 500) return '$$';
            if (priceNum < 1000) return '$$$';
            return '$$$$';
        }

        function filterAndDisplayVendors() {
            const searchTerm = searchInput.value.toLowerCase();
            const category = categoryFilter.value;
            const location = locationFilter.value;
            const sortBy = sortSelect.value;
            const activeCategoryFilter = document.querySelector('.category-filter.active').dataset.category;

            let filteredVendors = allVendors.filter(vendor => {
                const matchesSearch = !searchTerm || 
                    vendor.name.toLowerCase().includes(searchTerm) ||
                    vendor.category.toLowerCase().includes(searchTerm) ||
                    (vendor.location && vendor.location.toLowerCase().includes(searchTerm)) ||
                    (vendor.description && vendor.description.toLowerCase().includes(searchTerm));

                const matchesCategory = !category || vendor.category === category;
                const matchesLocation = !location || (vendor.location && vendor.location.includes(location));
                const matchesCategoryFilter = !activeCategoryFilter || 
                    (activeCategoryFilter === 'premium' ? vendor.isPremium : vendor.category === activeCategoryFilter);

                return matchesSearch && matchesCategory && matchesLocation && matchesCategoryFilter;
            });

            // Sort vendors
            filteredVendors.sort((a, b) => {
                switch (sortBy) {
                    case 'rating':
                        return (parseFloat(b.rating) || 0) - (parseFloat(a.rating) || 0);
                    case 'price':
                        const priceOrder = {'$': 1, '$$': 2, '$$$': 3, '$$$$': 4};
                        return (priceOrder[b.priceRange] || 0) - (priceOrder[a.priceRange] || 0);
                    default:
                        return a.name.localeCompare(b.name);
                }
            });

            displayVendors(filteredVendors);
            updatePagination(filteredVendors.length);
        }

        function displayVendors(vendors) {
            const startIndex = (currentPage - 1) * vendorsPerPage;
            const endIndex = startIndex + vendorsPerPage;
            const vendorsToShow = vendors.slice(startIndex, endIndex);

            if (vendorsToShow.length === 0) {
                showNoVendorsMessage('No vendors match your search criteria. Try adjusting your filters.');
                return;
            }

            // Use DocumentFragment for smooth batch updates
            const fragment = document.createDocumentFragment();
            
            vendorsToShow.forEach(vendor => {
                const vendorElement = document.createElement('div');
                vendorElement.className = `vendor-card ${vendor.isPremium ? 'premium' : ''}`;
                vendorElement.innerHTML = `
                    <img src="${vendor.logoUrl || getCategoryImage(vendor.category)}" 
                         alt="${vendor.name}" 
                         class="vendor-image"
                         loading="lazy"
                         onerror="this.src='../assets/placeholder.jpg'">
                    <div class="vendor-content">
                        <div class="vendor-header">
                            <div class="vendor-avatar">${getInitials(vendor.name)}</div>
                            <div class="vendor-info">
                                <h3>${vendor.name}</h3>
                                <p class="vendor-category">${vendor.category}</p>
                                <p class="vendor-location">
                                    <i class="fas fa-map-marker-alt"></i> ${vendor.location}
                                </p>
                            </div>
                        </div>
                        <p class="vendor-description">${vendor.description}</p>
                        <div class="vendor-stats">
                            <div class="stat">
                                <div class="stat-value">${vendor.rating}</div>
                                <div class="stat-label">Rating</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value">${getRandomEventCount()}+</div>
                                <div class="stat-label">Events</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value">${vendor.priceRange}</div>
                                <div class="stat-label">Price Range</div>
                            </div>
                        </div>
                        <div class="vendor-actions">
                            <a href="vendor-profile.html?id=${vendor.id}" class="btn-primary">View Profile</a>
                            <button class="btn-secondary contact-btn" data-vendor-id="${vendor.id}">Contact</button>
                        </div>
                    </div>
                `;
                
                // Add click event for the card
                vendorElement.addEventListener('click', (e) => {
                    // Don't trigger if clicking contact button
                    if (!e.target.closest('.contact-btn')) {
                        viewProfile(vendor.id);
                    }
                });
                
                // Add click event for contact button
                const contactBtn = vendorElement.querySelector('.contact-btn');
                contactBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    contactVendor(vendor.id);
                });
                
                fragment.appendChild(vendorElement);
            });

            // Single smooth DOM update
            vendorsContainer.innerHTML = '';
            vendorsContainer.appendChild(fragment);
        }

        // Helper function to get category-based images
        function getCategoryImage(category) {
            const categoryImages = {
                'photography': '../assets/photography.jpg',
                'catering': '../assets/catering6.jpg',
                'venue': '../assets/venues.jpg',
                'florist': '../assets/florists.jpg',
                'planner': '../assets/planner.jpg',
                'music': '../assets/cards.jpg',
                'cake': '../assets/cake5.jpg',
                'transportation': '../assets/cars.jpg',
                'beauty': '../assets/salon.jpg',
                'attire': '../assets/attire.jpg',
                'jewelry': '../assets/ring.jpg'
            };
            
            const categoryLower = (category || 'general').toLowerCase();
            return categoryImages[categoryLower] || '../assets/placeholder.jpg';
        }

        function showNoVendorsMessage(message = 'No vendors found.') {
            vendorsContainer.innerHTML = `
                <div class="no-vendors">
                    <i class="fas fa-search"></i>
                    <h3>No Vendors Found</h3>
                    <p>${message}</p>
                </div>
            `;
        }

        function updatePagination(totalVendors) {
            const totalPages = Math.ceil(totalVendors / vendorsPerPage);
            
            if (totalPages <= 1) {
                pagination.style.display = 'none';
                return;
            }

            pagination.style.display = 'flex';
            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages;
        }

        function getInitials(name) {
            return name.split(' ').map(word => word[0]).join('').toUpperCase().substring(0, 2);
        }

        function getRandomEventCount() {
            return Math.floor(Math.random() * 250) + 50;
        }

        // Debounced event listeners to prevent flickering
        searchInput.addEventListener('input', () => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                currentPage = 1;
                filterAndDisplayVendors();
            }, 300);
        });

        categoryFilter.addEventListener('change', () => {
            clearTimeout(filterTimeout);
            filterTimeout = setTimeout(() => {
                currentPage = 1;
                filterAndDisplayVendors();
            }, 200);
        });

        locationFilter.addEventListener('change', () => {
            clearTimeout(filterTimeout);
            filterTimeout = setTimeout(() => {
                currentPage = 1;
                filterAndDisplayVendors();
            }, 200);
        });

        sortSelect.addEventListener('change', () => {
            clearTimeout(filterTimeout);
            filterTimeout = setTimeout(() => {
                currentPage = 1;
                filterAndDisplayVendors();
            }, 200);
        });

        categoryFilters.forEach(filter => {
            filter.addEventListener('click', () => {
                clearTimeout(filterTimeout);
                filterTimeout = setTimeout(() => {
                    categoryFilters.forEach(f => f.classList.remove('active'));
                    filter.classList.add('active');
                    currentPage = 1;
                    filterAndDisplayVendors();
                }, 150);
            });
        });

        prevPageBtn.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                filterAndDisplayVendors();
            }
        });

        nextPageBtn.addEventListener('click', () => {
            const totalPages = Math.ceil(allVendors.length / vendorsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                filterAndDisplayVendors();
            }
        });

        // Global functions
        window.viewProfile = function(vendorId) {
            if (!vendorId) return;
            window.location.href = `vendor-profile.html?id=${vendorId}`;
        };

        window.contactVendor = function(vendorId) {
            const vendor = allVendors.find(v => v.id === vendorId);
            if (vendor) {
                alert(`Contacting ${vendor.name}...\n\nEmail: ${vendor.contact}\nLocation: ${vendor.location}\n\nYou can reach out to them directly for more information!`);
            }
        };

        // Load vendors when page loads
        window.addEventListener('DOMContentLoaded', fetchVendors);
    </script>
    <script src="../script.js"></script>
</body>
</html>